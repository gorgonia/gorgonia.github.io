<!doctype html><html lang=ja class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia: Deep learning for Go - Write and evaluate mathematical equations involving multidimensional arrays (tensors) easily - this is the reference website with tutorials and howtos"><meta name=author content="The Gorgonia Authors"><link rel="shortcut icon" href=/images/favicon.png type=image/png><title>簡単なニューラルネットの構築 (MNIST) :: Gorgonia</title><link href=/css/nucleus.css?1603034271 rel=stylesheet><link href=/css/fontawesome-all.min.css?1603034271 rel=stylesheet><link href=/css/hybrid.css?1603034271 rel=stylesheet><link href=/css/featherlight.min.css?1603034271 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1603034271 rel=stylesheet><link href=/css/auto-complete.css?1603034271 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1603034271 rel=stylesheet><link href=/css/theme.css?1603034271 rel=stylesheet><link href=/css/hugo-theme.css?1603034271 rel=stylesheet><link href=/css/theme-gorgonia.css?1603034271 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1603034271></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="簡単なニューラルネットの構築 (MNIST)"><meta property=og:description content="はじめに これは MNIST データセットを使って convocation neural network を段階的に構築し練習する為のチュートリアルです。
完全なコードは、Gorgonia メインリポジトリの examples ディレクトリにあります。 このチュートリアルの目的はコードを詳細に説明することです。 仕組みの詳細については、次の書籍で見ることができます。 Go Machine Learning Projects
データセット このパートではデータセットの読み込みと表示について説明します。ニューラルネットの個所に直接ジャンプしたい場合はスキップして Convolution Neural Net part に進んでください。
 学習およびテストセットは次からダウンロードできます。 Yann LeCun&rsquo;s MNIST website
 train-images-idx3-ubyte.gz: training set images (9912422 bytes) train-labels-idx1-ubyte.gz: training set labels (28881 bytes) t10k-images-idx3-ubyte.gz: test set images (1648877 bytes) t10k-labels-idx1-ubyte.gz: test set labels (4542 bytes)  Every image/label starts with a magic number. The encoding/binary package of the standard library of Go makes it easy to read those files."><meta property=og:type content=article><meta property=og:url content=https://gorgonia.org/ja/tutorials/mnist/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-29T20:09:05+01:00><meta property=article:modified_time content=2019-10-29T20:09:05+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="簡単なニューラルネットの構築 (MNIST)"><meta name=twitter:description content="はじめに これは MNIST データセットを使って convocation neural network を段階的に構築し練習する為のチュートリアルです。
完全なコードは、Gorgonia メインリポジトリの examples ディレクトリにあります。 このチュートリアルの目的はコードを詳細に説明することです。 仕組みの詳細については、次の書籍で見ることができます。 Go Machine Learning Projects
データセット このパートではデータセットの読み込みと表示について説明します。ニューラルネットの個所に直接ジャンプしたい場合はスキップして Convolution Neural Net part に進んでください。
 学習およびテストセットは次からダウンロードできます。 Yann LeCun&rsquo;s MNIST website
 train-images-idx3-ubyte.gz: training set images (9912422 bytes) train-labels-idx1-ubyte.gz: training set labels (28881 bytes) t10k-images-idx3-ubyte.gz: test set images (1648877 bytes) t10k-labels-idx1-ubyte.gz: test set labels (4542 bytes)  Every image/label starts with a magic number. The encoding/binary package of the standard library of Go makes it easy to read those files."></head><body data-url=/ja/tutorials/mnist/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://gorgonia.org/><img src=https://gorgonia.org/images/logo/gorgonia.svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=検索...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1603034271></script><script type=text/javascript src=/js/auto-complete.js?1603034271></script><script type=text/javascript>var baseurl="https:\/\/gorgonia.org\/\/ja";</script><script type=text/javascript src=/js/search.js?1603034271></script><ul><li><a class=padding><em class="fas fa-language fa-fw"></em><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://gorgonia.org/tutorials/mnist/>English</option>
<option id=ja value=https://gorgonia.org/ja/tutorials/mnist/ selected>Japanese</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/ja/getting-started/ title=事始め class=dd-item><a href=/ja/getting-started/>事始め
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/getting-started/contributing-doc/ title=ドキュメントへの貢献を始める class=dd-item><a href=/ja/getting-started/contributing-doc/>ドキュメントへの貢献を始める
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/ja/about/ title=Gorgoniaの仕組み class=dd-item><a href=/ja/about/>Gorgoniaの仕組み
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/about/computation-graph/ title=計算グラフ class=dd-item><a href=/ja/about/computation-graph/>計算グラフ
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/about/differentiation/ title=微分 class=dd-item><a href=/ja/about/differentiation/>微分
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/about/differentiation/symbolicdiff/ title=数式微分 class=dd-item><a href=/ja/about/differentiation/symbolicdiff/>数式微分
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/about/differentiation/autodiff/ title=自動微分 class=dd-item><a href=/ja/about/differentiation/autodiff/>自動微分
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/ja/tutorials/ title=チュートリアル class="dd-item
        parent"><a href=/ja/tutorials/>チュートリアル
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/tutorials/hello-world/ title=こんにちわ世界 class=dd-item><a href=/ja/tutorials/hello-world/>こんにちわ世界
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/tutorials/mnist/ title="簡単なニューラルネットの構築 (MNIST)" class="dd-item active"><a href=/ja/tutorials/mnist/>簡単なニューラルネットの構築 (MNIST)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/tutorials/iris/ title="Iris データセットでの多変量線形回帰" class=dd-item><a href=/ja/tutorials/iris/>Iris データセットでの多変量線形回帰
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/ja/how-to/ title=ハウツー class=dd-item><a href=/ja/how-to/>ハウツー
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/how-to/dot/ title="Graphviz (dot) を用いた ExprGraph の描画" class=dd-item><a href=/ja/how-to/dot/>Graphviz (dot) を用いた ExprGraph の描画
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/how-to/dataframe/ title="データフレームからテンソルを作成 (gota)" class=dd-item><a href=/ja/how-to/dataframe/>データフレームからテンソルを作成 (gota)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/how-to/save-weights/ title=Weightsの保存 class=dd-item><a href=/ja/how-to/save-weights/>Weightsの保存
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/ja/reference/ title=リファレンスガイド class=dd-item><a href=/ja/reference/>リファレンスガイド
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/reference/exprgraph/ title="グラフと Exprgraph" class=dd-item><a href=/ja/reference/exprgraph/>グラフと Exprgraph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/reference/present/ title=発表 class=dd-item><a href=/ja/reference/present/>発表
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/reference/tensor/ title=Tensor class=dd-item><a href=/ja/reference/tensor/>Tensor
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/reference/solver/ title=Solvers class=dd-item><a href=/ja/reference/solver/>Solvers
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/reference/vm/ title=VM class=dd-item><a href=/ja/reference/vm/>VM
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ja/reference/vm/lispmachine/ title=LispMachine class=dd-item><a href=/ja/reference/vm/lispmachine/>LispMachine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ja/reference/vm/tapemachine/ title=Tapemachine class=dd-item><a href=/ja/reference/vm/tapemachine/>Tapemachine
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/ja/misc/ title=その他 class=dd-item><a href=/ja/misc/>その他
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>更に</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a class=padding href="https://pkg.go.dev/gorgonia.org/gorgonia?tab=doc"><i class="fas fa-fw fa-bookmark"></i>API Doc</a></li><li><a class=padding href=http://gophers.slack.com/messages/gorgonia><i class="fab fa-fw fa-slack"></i>Contact us</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>履歴削除</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title=このページを編集 href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/tutorials/mnist.ja.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>このページを編集</span></a></div><div id=breadcrumbs itemscope itemtype=http://schema.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/ja/>main</a> > <a href=/ja/tutorials/>チュートリアル</a> > 簡単なニューラルネットの構築 (MNIST)</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#はじめに>はじめに</a><ul><li><a href=#データセット>データセット</a><ul><li><ul><li><a href=#mnist-パッケージ>&lsquo;mnist&rsquo; パッケージ</a></li><li><a href=#パッケージのテスト>パッケージのテスト</a></li></ul></li><li><a href=#画像の表現>画像の表現</a></li></ul></li></ul></li><li><a href=#畳み込みニューラルネット>畳み込みニューラルネット</a><ul><li><a href=#ネットワークの変数>ネットワークの変数</a><ul><li><a href=#learnables-の定義>learnables の定義</a></li></ul></li><li><a href=#ネットワークの定義>ネットワークの定義</a></li><li><a href=#ネットワークのトレーニング>ネットワークのトレーニング</a><ul><li><a href=#コスト関数>コスト関数</a><ul><li><a href=#トレーニングループ>トレーニングループ</a></li><li><a href=#ループの中身>ループの中身:</a></li></ul></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>簡単なニューラルネットの構築 (MNIST)</h1><h2 id=はじめに>はじめに</h2><p>これは MNIST データセットを使って convocation neural network を段階的に構築し練習する為のチュートリアルです。</p><p>完全なコードは、Gorgonia メインリポジトリの <code>examples</code> ディレクトリにあります。
このチュートリアルの目的はコードを詳細に説明することです。 仕組みの詳細については、次の書籍で見ることができます。 <a href=https://www.packtpub.com/eu/big-data-and-business-intelligence/go-machine-learning-projects>Go Machine Learning Projects</a></p><h3 id=データセット>データセット</h3><div class="notices info"><p>このパートではデータセットの読み込みと表示について説明します。ニューラルネットの個所に直接ジャンプしたい場合はスキップして <a href=#the-convolution-neural-net>Convolution Neural Net part</a> に進んでください。</p></div><p>学習およびテストセットは次からダウンロードできます。 <a href=http://yann.lecun.com/exdb/mnist/>Yann LeCun&rsquo;s MNIST website</a></p><ul><li><a href=http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz>train-images-idx3-ubyte.gz</a>: training set images (9912422 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz>train-labels-idx1-ubyte.gz</a>: training set labels (28881 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz>t10k-images-idx3-ubyte.gz</a>: test set images (1648877 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz>t10k-labels-idx1-ubyte.gz</a>: test set labels (4542 bytes)</li></ul><p>Every image/label starts with a magic number. The <code>encoding/binary</code> package of the standard library of Go makes it easy to read those files.
すべての画像やラベルはマジックナンバーで始まります。Goの標準ライブラリの <code>encoding / binary</code> パッケージを使用するとこれらのファイルを簡単に読み取ることができます。</p><h5 id=mnist-パッケージ>&lsquo;mnist&rsquo; パッケージ</h5><p>コモディティとして Gorgonia は <code>examples</code> サブディレクトリにパッケージ<code>mnist</code> を作成しました。データから情報を抽出し <code>tensors</code> を作成することをゴールとしています。。</p><p>この関数 <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/io.go#L50:6><code>readImageFile</code></a> は reader に含まれる画像の全体を表すバイト列を作ります。</p><p>よく似た関数 <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/io.go#L21><code>readLabelFile</code></a> はラベルを展開します。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Image holds the pixel intensities of an image.
</span><span style=color:#8f5902;font-style:italic>// 255 is foreground (black), 0 is background (white).
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>RawImage</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span>

<span style=color:#8f5902;font-style:italic>// Label is a digit label in 0 to 9
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Label</span> <span style=color:#204a87;font-weight:700>uint8</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>readImageFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r</span> <span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reader</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>imgs</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>RawImage</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>readLabelFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r</span> <span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reader</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>そして2つの関数は <code>RawImage</code> と <code>Label</code> から <code>tensor.Tensor</code> への変換処理を担います。</p><ul><li><a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L70>prepareX</a></li><li><p><a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L99>prepareY</a></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>prepareX</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>M</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>RawImage</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>retVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>prepareY</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>N</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>retVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>)</span></code></pre></div></li></ul><p>パッケージからエクスポートされる関数は <code>loc</code> からファイル <code>typ</code> を読み取って特定の型のテンソル(float32またはfloat64)を返す <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L24><code>Load</code></a> のみです。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Load loads the mnist data into two tensors
</span><span style=color:#8f5902;font-style:italic>//
</span><span style=color:#8f5902;font-style:italic>// typ can be &#34;train&#34;, &#34;test&#34;
</span><span style=color:#8f5902;font-style:italic>//
</span><span style=color:#8f5902;font-style:italic>// loc represents where the mnist files are held
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>loc</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>as</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span></code></pre></div><h5 id=パッケージのテスト>パッケージのテスト</h5><p>では簡単なメインファイルを作成してデータがロードされることを検証しましょう。</p><p>テストディレクトリのこのレイアウトは次のとおりです:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ ls -alhg *
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   375B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 main.go

testdata:
total <span style=color:#0000cf;font-weight:700>107344</span>
drwxr-xr-x  <span style=color:#0000cf;font-weight:700>6</span> staff   192B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 .
drwxr-xr-x  <span style=color:#0000cf;font-weight:700>4</span> staff   128B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 ..
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   <span style=color:#0000cf;font-weight:700>7</span>.5M Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> t10k-images.idx3-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   <span style=color:#0000cf;font-weight:700>9</span>.8K Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> t10k-labels.idx1-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff    45M Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> train-images.idx3-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff    59K Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> train-labels.idx1-ubyte</code></pre></div><p>次にテストデータとトレーニングデータの両方を読み取り、結果のテンソルを表示する単純な Go ファイルを作成します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#4e9a06>&#34;fmt&#34;</span>
        <span style=color:#4e9a06>&#34;log&#34;</span>

        <span style=color:#4e9a06>&#34;gorgonia.org/gorgonia/examples/mnist&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>typ</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;train&#34;</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>mnist</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;./testdata&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#000;font-weight:700>}</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34; inputs:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>())</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34; data:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>())</span>
        <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>実行します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ go run main.go
<span style=color:#204a87>test</span> inputs: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10000</span>, <span style=color:#0000cf;font-weight:700>784</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#204a87>test</span> data: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10000</span>, <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span>
train inputs: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>60000</span>, <span style=color:#0000cf;font-weight:700>784</span><span style=color:#ce5c00;font-weight:700>)</span>
train data: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>60000</span>, <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span></code></pre></div><p>テストセットには $28\times28=784 ピクセルの 60000 枚の写真、&rdquo;one-hot&rdquo; エンコードされた 60000 個のラベル、および 10000 個のテストファイルがあります。</p><h4 id=画像の表現>画像の表現</h4><p>最初の要素の画像を表示してみましょう:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#8f5902;font-style:italic>//...
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#4e9a06>&#34;image&#34;</span>
        <span style=color:#4e9a06>&#34;image/png&#34;</span>

        <span style=color:#4e9a06>&#34;gorgonia.org/gorgonia/examples/mnist&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor/native&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>mnist</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;train&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;./testdata&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>cols</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
        <span style=color:#000>imageBackend</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>uint8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cols</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>cols</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>v</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>At</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#000>imageBackend</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>uint8</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>v</span><span style=color:#000;font-weight:700>.(</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>0.9</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>img</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>image</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Gray</span><span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>Pix</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#000>imageBackend</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>Stride</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>Rect</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>image</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rect</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>),</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Create</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;output.png&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>vals</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>native</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MatrixF64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>targets</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>png</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Encode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>img</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class="notices info"><p>基礎となる <code>[]float64</code> バックエンドに簡単にアクセスするために <code>native</code> パッケージを使用しています。この操作では新しいデータは生成されません。</p></div><p>これにより png ファイルが生成されます:
<img src="/images/mnist_5.png?width=10pc" alt=5></p><p>そして <code>5</code> であることを示す対応するラベルベクトルは:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ go run main.go
<span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.9 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1<span style=color:#ce5c00;font-weight:700>]</span></code></pre></div><h2 id=畳み込みニューラルネット>畳み込みニューラルネット</h2><p>5層の畳み込みネットワークを構築しています。 $x_0$ は1つ前で定義した入力画像です。</p><p>最初の3つのレイヤー $i$ は次のように定義されます:</p><p>$ x_{i+1} = Dropout(Maxpool(ReLU(Convolution(x_i,W_i)))) $</p><p>$i$ は 0-2 の範囲を取ります。</p><p>4番目のレイヤーは基本的にいくつかのアクティベーションを適度にゼロにするドロップアウトレイヤーです:</p><p>$ x_{4} = Dropout(ReLU(x_3\cdot W_3)) $</p><p>最後のレイヤーは出力ベクトルを取得するために単純な乗算とソフトマックスを適用します(このベクトルは予測したラベルを表します):</p><p>$ y = softmax(x_4\cdot W_4)$</p><h3 id=ネットワークの変数>ネットワークの変数</h3><p>学習可能なパラメーターは $W_0,W_1,W_2,W_3,W_4$ です。ネットワークの他の変数はドロップアウト確率 $d_0,d_1,d_2,d_3$ です。</p><p>モデルの変数と出力ノードを保持する構造を作成してみましょう:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>convnet</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>g</span>                  <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExprGraph</span>
	<span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w4</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span> <span style=color:#8f5902;font-style:italic>// weights. the number at the back indicates which layer it&#39;s used for
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>d0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d3</span>     <span style=color:#204a87;font-weight:700>float64</span>        <span style=color:#8f5902;font-style:italic>// dropout probabilities
</span><span style=color:#8f5902;font-style:italic></span>
	<span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h4 id=learnables-の定義>learnables の定義</h4><p>畳み込みは標準の $3\times3$ カーネルと32個のフィルターを使用しています。
データセットの画像は白黒なので1つのチャネルのみを使用しています。これは以下の重みの定義につながります。</p><ul><li>$W_0 \in \mathbb{R}^{32\times 1\times3\times3}$ は最初の畳み込み演算に</li><li>$W_1 \in \mathbb{R}^{64\times 32\times3\times3}$ は2つ目の畳み込み演算に</li><li>$W_2 \in \mathbb{R}^{128\times 64\times3\times3}$ は3つ目の畳み込み演算に</li><li>$W_3 \in \mathbb{R}^{128*3*3\times 625}$ 最終的な行列乗算の為に用意していますを準。4D入力を行列 (128x3x3) に変形する必要があります。625は任意の数字です。</li><li>$W_4 \in \mathbb{R}^{625\times 10}$ で出力サイズを10個のエントリの単一ベクトルに減らします。</li></ul><div class="notices note"><p>NN 最適化では、出力と入力よりも小さい中間層がある場合に無駄な情報を「圧縮する」ことがよく知られています。
入力は784なので次のレイヤーは小さくする必要があります。625 は格好良い数です。</p></div><p>ドロップアウトの確率は慣用的な値に固定されています：</p><ul><li>$d_0=0.2$</li><li>$d_1=0.2$</li><li>$d_2=0.2$</li><li>$d_3=0.55$</li></ul><p>これで学習可能なプレースホルダーを持った構造を作成できます:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Note: gorgonia is abbreviated G in this example for clarity
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>newConvNet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExprGraph</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>w0</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w0&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w1&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w2</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w2&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w3</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>625</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w3&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w4</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>625</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w4&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>g</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w4</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w4</span><span style=color:#000;font-weight:700>,</span>

		<span style=color:#000>d0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.55</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class="notices info"><p>The learnables are initialized with some values normally sampled using Glorot et al.&rsquo;s algorithm. For more info: <a href=https://arxiv.org/pdf/1511.06422.pdf>All you need is a good init</a> on Arxiv.
Learnablesは、通常Glorotらのアルゴリズムを使用してサンプリングされたいくつかの値で初期化されます。 詳細情報：[必要なのは適切なinitのみ]（<a href=https://arxiv.org/pdf/1511.06422.pdf）Arxivで。>https://arxiv.org/pdf/1511.06422.pdf）Arxivで。</a></p></div><h3 id=ネットワークの定義>ネットワークの定義</h3><p>convnet の構造にメソッドを追加することにより、ネットワークを定義できるようになりました:</p><p><em>Note</em>: わかりやすくするためにエラーチェックは再度削除しています</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// This function is particularly verbose for educational reasons. In reality, you&#39;d wrap up the layers within a layer struct type and perform per-layer activations
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>fwd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>fc</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a3</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>p2</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l3</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>

	<span style=color:#8f5902;font-style:italic>// LAYER 0
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// here we convolve with stride = (1, 1) and padding = (1, 1),
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// which is your bog standard convolution for convnet
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d0</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 1
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c1</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d1</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 2
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c2</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>

	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>r2</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#000>b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>
	<span style=color:#000>r2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>w</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d2</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 3
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>fc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w3</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>a3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fc</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>l3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d3</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// output decode
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w4</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SoftMax</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h3 id=ネットワークのトレーニング>ネットワークのトレーニング</h3><p>トレーニングセットから取得した入力は行列 $numExample \times 784$ です。畳み込み演算子は4Dテンソル BCHW を期待しています。最初にすべき事は入力の形状を変更することです:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>numExamples</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>numExamples</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>ネットワークをバッチで学習します。バッチサイズは変数（<code>bs</code>）です。現在のバッチの値とラベルを保持する2つの新しいテンソルを作成します。
次にニューラルネットをインスタンス化します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>newConvNet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fwd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span></code></pre></div><h4 id=コスト関数>コスト関数</h4><p>単純なクロスエントロピーに基づいて期待される出力を要素ごとに乗算し平均化することにより、値を最小化するコスト関数を定義します:</p><p>$cost = -\dfrac{1}{bs} \sum_{i=1}^{bs}(pred^{(i)}\cdot y^{(i)})$</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>losses</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HadamardProd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>cost</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mean</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>losses</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>cost</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Neg</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>))</span></code></pre></div><p>後で使用するためにコストの値にポインターを渡します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>costVal</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>costVal</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>そして symbolic backpropagation を実行します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Learnables はこの様に定義します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nodes</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nodes</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w4</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h5 id=トレーニングループ>トレーニングループ</h5><p>まずグラフを実行するための <a href=/reference/vm>vm</a> と、各ステップで学習可能な値を適応させるためのソルバーが必要です。またソルバーが機能するように2つの学習可能な値に対して実際の値をバインドし、勾配の値を保存する必要があります。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>vm</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindDualValues</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>solver</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewRMSPropSolver</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithBatchSize</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>float64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>)))</span>
<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span></code></pre></div><p>バッチサイズを考慮したエポックを構成するいくつかのバッチを定義します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>batches</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>numExamples</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>bs</span></code></pre></div><p>次にトレーニングループを作成します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>epochs</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>b</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>batches</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#8f5902;font-style:italic>// ...
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h5 id=ループの中身>ループの中身:</h5><p>次に各バッチの入力テンソル ($60000 \times 784$) から値を抽出する必要があります。
各入力は ($bs\times 784$) です。最初のバッチは 0 から bs-1 までの値、2番目の bs から 2*bs-1 までの値を保持します。そしてテンソルを4Dテンソルに変形します:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>xVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span>
<span style=color:#000>xVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Slice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sli</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>end</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#000>yVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Slice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sli</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>end</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#000>xVal</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>そしてグラフに値を割り当てます:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xVal</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yVal</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>VMとソルバーを実行して重みを調整します。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodesToValueGrads</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()))</span>
<span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reset</span><span style=color:#000;font-weight:700>()</span></code></pre></div><p>これで学習できるニューラルネットワークができました。</p><h3 id=おわりに>おわりに</h3><p>大量のデータが含まれるためコードの実行は比較的遅くなりますが学習はできています。
<a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/convnet/main.go#L1>Gorgoniaのサンプルディレクトリ</a> で完全なコードを見ることができます。</p><p>重みを保存するには <a href=/tutorials/iris>irisチュートリアル</a> で説明されているように <code>load</code> と <code>save</code> の2つのメソッドを作成できます。
そして読者への練習としては、このニューラルネットワークを使う為の小さなユーティリティをコーディングがあります。</p><p>Have fun!</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/ja/tutorials/hello-world/ title=こんにちわ世界><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/ja/tutorials/iris/ title="Iris データセットでの多変量線形回帰" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1603034271></script><script src=/js/perfect-scrollbar.min.js?1603034271></script><script src=/js/perfect-scrollbar.jquery.min.js?1603034271></script><script src=/js/jquery.sticky.js?1603034271></script><script src=/js/featherlight.min.js?1603034271></script><script src=/js/modernizr.custom-3.6.0.js?1603034271></script><script src=/js/learn.js?1603034271></script><script src=/js/hugo-learn.js?1603034271></script><link href=/mermaid/mermaid.css?1603034271 rel=stylesheet><script src=/mermaid/mermaid.js?1603034271></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>