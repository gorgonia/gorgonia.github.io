<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia: Deep learning for Go - Write and evaluate mathematical equations involving multidimensional arrays (tensors) easily - this is the reference website with tutorials and howtos"><meta name=author content="The Gorgonia Authors"><link rel="shortcut icon" href=/images/favicon.png type=image/png><title>How to compute gradient (differentiation) :: Gorgonia</title><link href=/css/nucleus.css?1636396250 rel=stylesheet><link href=/css/fontawesome-all.min.css?1636396250 rel=stylesheet><link href=/css/hybrid.css?1636396250 rel=stylesheet><link href=/css/featherlight.min.css?1636396250 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1636396250 rel=stylesheet><link href=/css/auto-complete.css?1636396250 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1636396250 rel=stylesheet><link href=/css/theme.css?1636396250 rel=stylesheet><link href=/css/hugo-theme.css?1636396250 rel=stylesheet><link href=/css/theme-gorgonia.css?1636396250 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1636396250></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="How to compute gradient (differentiation)"><meta property=og:description content="Goal Consider this simple equation:
$$ f(x,y,z) = ( x &#43; y ) \times z $$
The goal of this article is to show you how Gorgonia can evaluate the gradient $\nabla f$ with its partial derivatives:
$$ \nabla f = [\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}, \frac{\partial f}{\partial z}] $$
Explanation Using the chain rule, we can compute the gradient value at each step as illustrated here:
graph LR; x --|$x=-2$"><meta property=og:type content=article><meta property=og:url content=https://gorgonia.org/how-to/autodiff/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-29T20:07:07+01:00><meta property=article:modified_time content=2019-10-29T20:07:07+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="How to compute gradient (differentiation)"><meta name=twitter:description content="Goal Consider this simple equation:
$$ f(x,y,z) = ( x &#43; y ) \times z $$
The goal of this article is to show you how Gorgonia can evaluate the gradient $\nabla f$ with its partial derivatives:
$$ \nabla f = [\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}, \frac{\partial f}{\partial z}] $$
Explanation Using the chain rule, we can compute the gradient value at each step as illustrated here:
graph LR; x --|$x=-2$"></head><body data-url=/how-to/autodiff/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://gorgonia.org/><img src=https://gorgonia.org/images/logo/gorgonia.svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1636396250></script><script type=text/javascript src=/js/auto-complete.js?1636396250></script><script type=text/javascript>var baseurl="https:\/\/gorgonia.org\/";</script><script type=text/javascript src=/js/search.js?1636396250></script><ul><li><a class=padding><em class="fas fa-language fa-fw"></em><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://gorgonia.org/how-to/autodiff/ selected>English</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/>Getting Started
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/getting-started/ubiquitous-language/ title="Ubiquitous Language and glossary" class=dd-item><a href=/getting-started/ubiquitous-language/>Ubiquitous Language and glossary
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/getting-started/contributing-doc/ title="Start contributing to the doc" class=dd-item><a href=/getting-started/contributing-doc/>Start contributing to the doc
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/about/ title="How Gorgonia works" class=dd-item><a href=/about/>How Gorgonia works
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/computation-graph/ title="Computation Graph" class=dd-item><a href=/about/computation-graph/>Computation Graph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/ title=Differentiation class=dd-item><a href=/about/differentiation/>Differentiation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/differentiation/autodiff/ title="Automatic Differentiation" class=dd-item><a href=/about/differentiation/autodiff/>Automatic Differentiation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/symbolicdiff/ title="Symbolic Differentiation" class=dd-item><a href=/about/differentiation/symbolicdiff/>Symbolic Differentiation
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/tutorials/ title=Tutorials class=dd-item><a href=/tutorials/>Tutorials
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/tutorials/hello-world/ title="Hello World" class=dd-item><a href=/tutorials/hello-world/>Hello World
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist/ title="Simple Convolution Neural Net (MNIST)" class=dd-item><a href=/tutorials/mnist/>Simple Convolution Neural Net (MNIST)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist-cuda/ title="Convnet with CUDA" class=dd-item><a href=/tutorials/mnist-cuda/>Convnet with CUDA
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/iris/ title="Multivariate linear regression on Iris Dataset" class=dd-item><a href=/tutorials/iris/>Multivariate linear regression on Iris Dataset
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/how-to/ title="How To" class="dd-item
        parent"><a href=/how-to/>How To
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/how-to/troubleshoot-gpu-issues/ title="Troubleshoot GPU Issues" class=dd-item><a href=/how-to/troubleshoot-gpu-issues/>Troubleshoot GPU Issues
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dot/ title="Drawing the ExprGraph with Graphviz (dot)" class=dd-item><a href=/how-to/dot/>Drawing the ExprGraph with Graphviz (dot)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dataframe/ title="Create a tensor from a Dataframe (gota)" class=dd-item><a href=/how-to/dataframe/>Create a tensor from a Dataframe (gota)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/save-weights/ title="Save Weights" class=dd-item><a href=/how-to/save-weights/>Save Weights
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/autodiff/ title="How to compute gradient (differentiation)" class="dd-item active"><a href=/how-to/autodiff/>How to compute gradient (differentiation)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/reference/ title="Reference guide" class=dd-item><a href=/reference/>Reference guide
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/exprgraph/ title="Graph / Exprgraph" class=dd-item><a href=/reference/exprgraph/>Graph / Exprgraph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/present/ title=Present class=dd-item><a href=/reference/present/>Present
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/cuda/ title="CUDA support" class=dd-item><a href=/reference/cuda/>CUDA support
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/tensor/ title=Tensor class=dd-item><a href=/reference/tensor/>Tensor
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/solver/ title=Solvers class=dd-item><a href=/reference/solver/>Solvers
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/ title=VM class=dd-item><a href=/reference/vm/>VM
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/vm/gomachine/ title="Go Machine" class=dd-item><a href=/reference/vm/gomachine/>Go Machine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/lispmachine/ title=LispMachine class=dd-item><a href=/reference/vm/lispmachine/>LispMachine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/tapemachine/ title=Tapemachine class=dd-item><a href=/reference/vm/tapemachine/>Tapemachine
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/misc/ title=Miscellaneous class=dd-item><a href=/misc/>Miscellaneous
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href="https://pkg.go.dev/gorgonia.org/gorgonia?tab=doc"><i class="fas fa-fw fa-bookmark"></i>API Doc</a></li><li><a class=padding href=http://gophers.slack.com/messages/gorgonia><i class="fab fa-fw fa-slack"></i>Contact us</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/how-to/autodiff.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://schema.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>main</a> > <a href=/how-to/>How To</a> > How to compute gradient (differentiation)</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#goal>Goal</a><ul><li><a href=#explanation>Explanation</a></li></ul></li><li><a href=#creating-the-equation>Creating the equation</a><ul><li><a href=#getting-the-gradients>Getting The Gradients</a><ul><li><a href=#automatic-differentiation>Automatic Differentiation</a></li><li><a href=#symbolic-differentiation>Symbolic Differentiation</a></li></ul></li></ul></li><li><a href=#full-code-automatic-differentiation>Full Code (Automatic Differentiation)</a></li><li><a href=#full-code-symbolic-differentiation>Full Code (Symbolic Differentiation)</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>How to compute gradient (differentiation)</h1><h2 id=goal>Goal</h2><p>Consider this simple equation:</p><p>$$ f(x,y,z) = ( x + y ) \times z $$</p><p>The goal of this article is to show you how Gorgonia can evaluate the gradient $\nabla f$ with its partial derivatives:</p><p>$$ \nabla f = [\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}, \frac{\partial f}{\partial z}] $$</p><h3 id=explanation>Explanation</h3><p>Using the <a href=https://www.khanacademy.org/math/ap-calculus-ab/ab-differentiation-2-new/ab-3-1a/a/chain-rule-review>chain rule</a>, we can compute the gradient value at each step as illustrated here:</p><div class=mermaid align=left>graph LR;
x -->|$x=-2$<br>$\partial f/\partial x = -4$| add
y -->|$y=5$<br>$\partial f/\partial y = -4$| add
add(+) -->|$q=3$<br>$\partial f/\partial q = -4$| mul
z -->|$z=-4$<br>$\partial f/\partial z = 3$| mul
mul(*) -->|$f=-12$<br>$1$| f</div><div class="notices info"><p>For more info on the gradient computation, please read this <a href=http://cs231n.github.io/optimization-2/>article from cs231n</a> from Stanford.</p></div><p>We will represent this equation into an <a href=/reference/exprgraph>exprgraph</a> and see how to ask Gorgonia to compute the gradient.</p><p>When the computation is done, each node will hold a <a href=/reference/dualvalue>dual value</a> that will contain both the actual value and the derivative wrt to x.</p><p>for example, considering the node x:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span></code></pre></div><p>Once Gorgonia has evaluated the exprgraph, it is possible to extract the value of <code>x</code> and the value of the gradient $\frac{\partial f}{\partial x}$ by calling:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>xValue</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>()</span>    <span style=color:#8f5902;font-style:italic>// -2
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>dfdx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>()</span>    <span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>please</span> <span style=color:#000>check</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>errors</span> <span style=color:#000>in</span> <span style=color:#000>proper</span> <span style=color:#000>code</span></code></pre></div><p>Let&rsquo;s see how to do that.</p><h2 id=creating-the-equation>Creating the equation</h2><p>First, let&rsquo;s create the <a href=/reference/exprgraph>exprgraph</a> that represents the equation.</p><div class="notices info"><p>If you want more info on this part, please read the <a href=/tutorials/hello-world/>hello world</a> tutorial.</p></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span>

<span style=color:#8f5902;font-style:italic>// define the expression
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>x</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>y</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>z</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;z&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>q</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#000>result</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>q</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>And set some values:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5.0</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4.0</span><span style=color:#000;font-weight:700>)</span></code></pre></div><h3 id=getting-the-gradients>Getting The Gradients</h3><p>There are two options to get the gradient:</p><ul><li>by using the <a href=https://en.wikipedia.org/wiki/Automatic_differentiation>automatic differentiation</a> capability of the <a href=/reference/lispmachine>LispMachine</a>;</li><li>by using the <a href=https://en.wikipedia.org/wiki/Computer_algebra>symbolic differentiation</a> capability offered by Gorgonia;</li></ul><h4 id=automatic-differentiation>Automatic Differentiation</h4><p>Automatic differentiation is only possible with the <a href=/reference/lispmachine>LispMachine</a>.
By default, lispmachine performs forward mode and backwards mode execution.</p><p>Therefore, calling the RunAll method is enough to get the result.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewLispMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>The values and gradients can now be extracted:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x=%v;y=%v;z=%v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;f(x,y,z) = %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dx: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dy: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dx: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h4 id=symbolic-differentiation>Symbolic Differentiation</h4><p>Another option is to use symbolic differentiation.
Symbolic differentiation works by adding new nodes to the graphs. The new nodes represents holds the gradients with regards to to the nodes passed as argument.</p><p>To create those new nodes, we use the <a href=https://godoc.org/gorgonia.org/gorgonia#Grad>Grad()</a> function.</p><p>Grad takes a scalar cost node and a list of with-regards-to, and returns the gradient</p><p>Consider the following code:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>grads</span> <span style=color:#000>Nodes</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>Grad</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>What this says is to compute the partial derivatives (gradients) with regards to <code>z</code>, <code>x</code> and <code>y</code>.</p><p><code>grads</code> in an array of <code>[]*gorgonia.Node</code>, in the same order as the WRTs that are passed in:</p><ul><li><code>grads[0]</code> = $\frac{\partial f}{\partial z}$</li><li><code>grads[1]</code> = $\frac{\partial f}{\partial x}$</li><li><code>grads[2]</code> = $\frac{\partial f}{\partial y}$</li></ul><p>The gradient is compatible with both <a href=/reference/tapemachine>TapeMachine</a> and <a href=/reference/lispmachine>LispMachine</a>. But TapeMachine is much faster.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;result: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>zgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dx: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>zgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dx: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dy: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>Note that you may access the partial derivatives in two ways:</p><ol><li>By using the <code>.Grad()</code> method. e.g. for the gradient of <code>x</code> in the running example, use <code>x.Grad()</code></li><li>By using the <code>.Value()</code> method of the gradient node. e.g. for the gradient of <code>x</code> in the running example, use <code>grads[1].Value()</code>.</li></ol><p>The reason for having these two different ways of doing things comes down to suitability. When it is more meaningful to get values from the gradient nodes (e.g. you might want to compute the second derivative), then use the gradient nodes. But if you want a fast fetching of the gradient values, the <code>.Grad()</code> method might be most suitable. Ultimately it comes down to your taste.</p><h2 id=full-code-automatic-differentiation>Full Code (Automatic Differentiation)</h2><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>

	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span>

	<span style=color:#8f5902;font-style:italic>// define the expression
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>x</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>y</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>z</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;z&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>q</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#000>result</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>q</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#8f5902;font-style:italic>// set initial values then run
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5.0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4.0</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// by default, lispmachine performs forward mode and backwards mode execution
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewLispMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x=%v;y=%v;z=%v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;f(x,y,z)=(x+y)*z\n&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;f(x,y,z) = %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dx: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dy: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;df/dz: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>which gives:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run main.go
x=-2;y=5;z=-4
f(x,y,z)=(x+y)*z
f(x,y,z) = -12
df/dx: -4
df/dy: -4
df/dz: 3</code></pre></div><h2 id=full-code-symbolic-differentiation>Full Code (Symbolic Differentiation)</h2><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>

	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span>

	<span style=color:#8f5902;font-style:italic>// define the expression
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>x</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>y</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>z</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScalar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;z&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>q</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#000>result</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>q</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>Grad</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#8f5902;font-style:italic>// set initial values then run
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5.0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4.0</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x=%v;y=%v;z=%v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;f(x,y,z)=(x+y)*z\n&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;f(x,y,z) = %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>zgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dx: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>zgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dx: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xgrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;dz/dy: %v | %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ygrad</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>grads</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>which gives:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run main.go
x=-2;y=5;z=-4
f(x,y,z)=(x+y)*z
f(x,y,z) = -12
df/dx: -4 | -4
df/dy: -4 | -4
df/dz: 3 | 3</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/how-to/save-weights/ title="Save Weights"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/reference/ title="Reference guide" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1636396250></script><script src=/js/perfect-scrollbar.min.js?1636396250></script><script src=/js/perfect-scrollbar.jquery.min.js?1636396250></script><script src=/js/jquery.sticky.js?1636396250></script><script src=/js/featherlight.min.js?1636396250></script><script src=/js/modernizr.custom-3.6.0.js?1636396250></script><script src=/js/learn.js?1636396250></script><script src=/js/hugo-learn.js?1636396250></script><link href=/mermaid/mermaid.css?1636396250 rel=stylesheet><script src=/mermaid/mermaid.js?1636396250></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>