<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia: Deep learning for Go - Write and evaluate mathematical equations involving multidimensional arrays (tensors) easily - this is the reference website with tutorials and howtos"><meta name=author content="The Gorgonia Authors"><link rel="shortcut icon" href=/images/favicon.png type=image/png><title>Save Weights :: Gorgonia</title><link href=/css/nucleus.css?1677767295 rel=stylesheet><link href=/css/fontawesome-all.min.css?1677767295 rel=stylesheet><link href=/css/hybrid.css?1677767295 rel=stylesheet><link href=/css/featherlight.min.css?1677767295 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1677767295 rel=stylesheet><link href=/css/auto-complete.css?1677767295 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1677767295 rel=stylesheet><link href=/css/theme.css?1677767295 rel=stylesheet><link href=/css/hugo-theme.css?1677767295 rel=stylesheet><link href=/css/theme-gorgonia.css?1677767295 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1677767295></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="Save Weights"><meta property=og:description content="Goal The goal of this howto is to describe a way to save the values of the nodes and to restore them.
Implementation The best thing you can do right now is to save the value of the corresponding nodes and restore them.
The tensors are fulfilling the GobEncode and GobDecode interface and this is the best option. You can also save the backend as a slice of elements but this is a little bit trickier."><meta property=og:type content=article><meta property=og:url content=https://gorgonia.org/how-to/save-weights/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-29T20:07:16+01:00><meta property=article:modified_time content=2019-10-29T20:07:16+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="Save Weights"><meta name=twitter:description content="Goal The goal of this howto is to describe a way to save the values of the nodes and to restore them.
Implementation The best thing you can do right now is to save the value of the corresponding nodes and restore them.
The tensors are fulfilling the GobEncode and GobDecode interface and this is the best option. You can also save the backend as a slice of elements but this is a little bit trickier."></head><body data-url=/how-to/save-weights/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://gorgonia.org/><img src=https://gorgonia.org/images/logo/gorgonia.svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1677767295></script><script type=text/javascript src=/js/auto-complete.js?1677767295></script><script type=text/javascript>var baseurl="https:\/\/gorgonia.org\/";</script><script type=text/javascript src=/js/search.js?1677767295></script><ul><li><a class=padding><em class="fas fa-language fa-fw"></em><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://gorgonia.org/how-to/save-weights/ selected>English</option>
<option id=fr value=https://gorgonia.org/fr/how-to/save-weights/>Fran√ßais</option>
<option id=ja value=https://gorgonia.org/ja/how-to/save-weights/>Japanese</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/>Getting Started
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/getting-started/ubiquitous-language/ title="Ubiquitous Language and glossary" class=dd-item><a href=/getting-started/ubiquitous-language/>Ubiquitous Language and glossary
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/getting-started/contributing-doc/ title="Start contributing to the doc" class=dd-item><a href=/getting-started/contributing-doc/>Start contributing to the doc
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/about/ title="How Gorgonia works" class=dd-item><a href=/about/>How Gorgonia works
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/computation-graph/ title="Computation Graph" class=dd-item><a href=/about/computation-graph/>Computation Graph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/ title=Differentiation class=dd-item><a href=/about/differentiation/>Differentiation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/differentiation/autodiff/ title="Automatic Differentiation" class=dd-item><a href=/about/differentiation/autodiff/>Automatic Differentiation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/symbolicdiff/ title="Symbolic Differentiation" class=dd-item><a href=/about/differentiation/symbolicdiff/>Symbolic Differentiation
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/tutorials/ title=Tutorials class=dd-item><a href=/tutorials/>Tutorials
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/tutorials/hello-world/ title="Hello World" class=dd-item><a href=/tutorials/hello-world/>Hello World
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist/ title="Simple Convolution Neural Net (MNIST)" class=dd-item><a href=/tutorials/mnist/>Simple Convolution Neural Net (MNIST)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist-cuda/ title="Convnet with CUDA" class=dd-item><a href=/tutorials/mnist-cuda/>Convnet with CUDA
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/iris/ title="Multivariate linear regression on Iris Dataset" class=dd-item><a href=/tutorials/iris/>Multivariate linear regression on Iris Dataset
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/how-to/ title="How To" class="dd-item
        parent"><a href=/how-to/>How To
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/how-to/troubleshoot-gpu-issues/ title="Troubleshoot GPU Issues" class=dd-item><a href=/how-to/troubleshoot-gpu-issues/>Troubleshoot GPU Issues
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dot/ title="Drawing the ExprGraph with Graphviz (dot)" class=dd-item><a href=/how-to/dot/>Drawing the ExprGraph with Graphviz (dot)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dataframe/ title="Create a tensor from a Dataframe (gota)" class=dd-item><a href=/how-to/dataframe/>Create a tensor from a Dataframe (gota)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/save-weights/ title="Save Weights" class="dd-item active"><a href=/how-to/save-weights/>Save Weights
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/autodiff/ title="How to compute gradient (differentiation)" class=dd-item><a href=/how-to/autodiff/>How to compute gradient (differentiation)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/reference/ title="Reference guide" class=dd-item><a href=/reference/>Reference guide
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/exprgraph/ title="Graph / Exprgraph" class=dd-item><a href=/reference/exprgraph/>Graph / Exprgraph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/present/ title=Present class=dd-item><a href=/reference/present/>Present
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/cuda/ title="CUDA support" class=dd-item><a href=/reference/cuda/>CUDA support
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/tensor/ title=Tensor class=dd-item><a href=/reference/tensor/>Tensor
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/solver/ title=Solvers class=dd-item><a href=/reference/solver/>Solvers
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/ title=VM class=dd-item><a href=/reference/vm/>VM
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/vm/gomachine/ title="Go Machine" class=dd-item><a href=/reference/vm/gomachine/>Go Machine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/lispmachine/ title=LispMachine class=dd-item><a href=/reference/vm/lispmachine/>LispMachine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/tapemachine/ title=Tapemachine class=dd-item><a href=/reference/vm/tapemachine/>Tapemachine
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/misc/ title=Miscellaneous class=dd-item><a href=/misc/>Miscellaneous
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href="https://pkg.go.dev/gorgonia.org/gorgonia?tab=doc"><i class="fas fa-fw fa-bookmark"></i>API Doc</a></li><li><a class=padding href=http://gophers.slack.com/messages/gorgonia><i class="fab fa-fw fa-slack"></i>Contact us</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/how-to/save-weights.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://schema.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>main</a> > <a href=/how-to/>How To</a> > Save Weights</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#goal>Goal</a></li><li><a href=#implementation>Implementation</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Save Weights</h1><h2 id=goal>Goal</h2><p>The goal of this howto is to describe a way to save the <a href=/reference/value>values</a> of the nodes and to restore them.</p><h2 id=implementation>Implementation</h2><p>The best thing you can do right now is to save the value of the corresponding nodes and restore them.</p><p>The tensors are fulfilling the <code>GobEncode</code> and <code>GobDecode</code> interface and this is the best option. You can also save the backend as a slice of elements but this is a little bit trickier.</p><p>Here is a sample code to do so (it is not optimized at all, feel free to amend it):</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#4e9a06>&#34;encoding/gob&#34;</span>
        <span style=color:#4e9a06>&#34;fmt&#34;</span>
        <span style=color:#4e9a06>&#34;log&#34;</span>
        <span style=color:#4e9a06>&#34;os&#34;</span>

        <span style=color:#4e9a06>&#34;gorgonia.org/gorgonia&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#000>backup</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/tmp/example_gorgonia&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>

        <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>z</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
        <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span>

        <span style=color:#8f5902;font-style:italic>// Create the graph
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>x</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>y</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span>
                <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#8f5902;font-style:italic>// Init variables
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>readFromBackup</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;cannot read backup, doing init&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#000>xT</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDense</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithBacking</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>}))</span>
                <span style=color:#000>yT</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDense</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithBacking</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>}))</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#8f5902;font-style:italic>// create a VM to run the program on
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>

        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>z</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>save</span><span style=color:#000;font-weight:700>([]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>})</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>readFromBackup</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>backup</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>dec</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gob</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDecoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span>
        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;decoding xT&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>dec</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Decode</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>xT</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;decoding yT&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>dec</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Decode</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>yT</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>save</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>nodes</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Create</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>backup</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>enc</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gob</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewEncoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>nodes</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>enc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Encode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>())</span>
                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
                <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>which gives:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$  go run main.go
2019/10/28 08:07:26 cannot read backup, doing init open /tmp/example_gorgonia: no such file or directory
‚é°0  2‚é§
‚é£4  6‚é¶
$  go run main.go
2019/10/28 08:07:29 decoding xT
2019/10/28 08:07:29 decoding yT
‚é°0  2‚é§
‚é£4  6‚é¶</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/how-to/dataframe/ title="Create a tensor from a Dataframe (gota)"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/how-to/autodiff/ title="How to compute gradient (differentiation)" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1677767295></script><script src=/js/perfect-scrollbar.min.js?1677767295></script><script src=/js/perfect-scrollbar.jquery.min.js?1677767295></script><script src=/js/jquery.sticky.js?1677767295></script><script src=/js/featherlight.min.js?1677767295></script><script src=/js/modernizr.custom-3.6.0.js?1677767295></script><script src=/js/learn.js?1677767295></script><script src=/js/hugo-learn.js?1677767295></script><link href=/mermaid/mermaid.css?1677767295 rel=stylesheet><script src=/mermaid/mermaid.js?1677767295></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>