<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia: Deep learning for Go - Write and evaluate mathematical equations involving multidimensional arrays (tensors) easily - this is the reference website with tutorials and howtos"><meta name=author content="The Gorgonia Authors"><link rel="shortcut icon" href=/images/favicon.png type=image/png><title>Multivariate linear regression on Iris Dataset :: Gorgonia</title><link href=/css/nucleus.css?1677767295 rel=stylesheet><link href=/css/fontawesome-all.min.css?1677767295 rel=stylesheet><link href=/css/hybrid.css?1677767295 rel=stylesheet><link href=/css/featherlight.min.css?1677767295 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1677767295 rel=stylesheet><link href=/css/auto-complete.css?1677767295 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1677767295 rel=stylesheet><link href=/css/theme.css?1677767295 rel=stylesheet><link href=/css/hugo-theme.css?1677767295 rel=stylesheet><link href=/css/theme-gorgonia.css?1677767295 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1677767295></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="Multivariate linear regression on Iris Dataset"><meta property=og:description content="About We will use Gorgonia to create a linear regression model.
The goal is, to predict the species of the Iris flowers given the characteristics:
 sepal_length sepal_width petal_length petal_width  The species we want to predict are:
 setosa virginica versicolor  The goal of this tutorial is to use Gorgonia to find the correct values of $\Theta$ given the iris dataset, in order to write a CLI utility that would look like this:"><meta property=og:type content=article><meta property=og:url content=https://gorgonia.org/tutorials/iris/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-31T14:53:37+01:00><meta property=article:modified_time content=2019-10-31T14:53:37+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="Multivariate linear regression on Iris Dataset"><meta name=twitter:description content="About We will use Gorgonia to create a linear regression model.
The goal is, to predict the species of the Iris flowers given the characteristics:
 sepal_length sepal_width petal_length petal_width  The species we want to predict are:
 setosa virginica versicolor  The goal of this tutorial is to use Gorgonia to find the correct values of $\Theta$ given the iris dataset, in order to write a CLI utility that would look like this:"></head><body data-url=/tutorials/iris/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://gorgonia.org/><img src=https://gorgonia.org/images/logo/gorgonia.svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1677767295></script><script type=text/javascript src=/js/auto-complete.js?1677767295></script><script type=text/javascript>var baseurl="https:\/\/gorgonia.org\/";</script><script type=text/javascript src=/js/search.js?1677767295></script><ul><li><a class=padding><em class="fas fa-language fa-fw"></em><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://gorgonia.org/tutorials/iris/ selected>English</option>
<option id=fr value=https://gorgonia.org/fr/tutorials/iris/>Fran√ßais</option>
<option id=ja value=https://gorgonia.org/ja/tutorials/iris/>Japanese</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/>Getting Started
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/getting-started/ubiquitous-language/ title="Ubiquitous Language and glossary" class=dd-item><a href=/getting-started/ubiquitous-language/>Ubiquitous Language and glossary
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/getting-started/contributing-doc/ title="Start contributing to the doc" class=dd-item><a href=/getting-started/contributing-doc/>Start contributing to the doc
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/about/ title="How Gorgonia works" class=dd-item><a href=/about/>How Gorgonia works
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/computation-graph/ title="Computation Graph" class=dd-item><a href=/about/computation-graph/>Computation Graph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/ title=Differentiation class=dd-item><a href=/about/differentiation/>Differentiation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/differentiation/autodiff/ title="Automatic Differentiation" class=dd-item><a href=/about/differentiation/autodiff/>Automatic Differentiation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/symbolicdiff/ title="Symbolic Differentiation" class=dd-item><a href=/about/differentiation/symbolicdiff/>Symbolic Differentiation
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/tutorials/ title=Tutorials class="dd-item
        parent"><a href=/tutorials/>Tutorials
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/tutorials/hello-world/ title="Hello World" class=dd-item><a href=/tutorials/hello-world/>Hello World
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist/ title="Simple Convolution Neural Net (MNIST)" class=dd-item><a href=/tutorials/mnist/>Simple Convolution Neural Net (MNIST)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist-cuda/ title="Convnet with CUDA" class=dd-item><a href=/tutorials/mnist-cuda/>Convnet with CUDA
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/iris/ title="Multivariate linear regression on Iris Dataset" class="dd-item active"><a href=/tutorials/iris/>Multivariate linear regression on Iris Dataset
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/how-to/ title="How To" class=dd-item><a href=/how-to/>How To
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/how-to/troubleshoot-gpu-issues/ title="Troubleshoot GPU Issues" class=dd-item><a href=/how-to/troubleshoot-gpu-issues/>Troubleshoot GPU Issues
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dot/ title="Drawing the ExprGraph with Graphviz (dot)" class=dd-item><a href=/how-to/dot/>Drawing the ExprGraph with Graphviz (dot)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dataframe/ title="Create a tensor from a Dataframe (gota)" class=dd-item><a href=/how-to/dataframe/>Create a tensor from a Dataframe (gota)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/save-weights/ title="Save Weights" class=dd-item><a href=/how-to/save-weights/>Save Weights
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/autodiff/ title="How to compute gradient (differentiation)" class=dd-item><a href=/how-to/autodiff/>How to compute gradient (differentiation)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/reference/ title="Reference guide" class=dd-item><a href=/reference/>Reference guide
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/exprgraph/ title="Graph / Exprgraph" class=dd-item><a href=/reference/exprgraph/>Graph / Exprgraph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/present/ title=Present class=dd-item><a href=/reference/present/>Present
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/cuda/ title="CUDA support" class=dd-item><a href=/reference/cuda/>CUDA support
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/tensor/ title=Tensor class=dd-item><a href=/reference/tensor/>Tensor
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/solver/ title=Solvers class=dd-item><a href=/reference/solver/>Solvers
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/ title=VM class=dd-item><a href=/reference/vm/>VM
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/vm/gomachine/ title="Go Machine" class=dd-item><a href=/reference/vm/gomachine/>Go Machine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/lispmachine/ title=LispMachine class=dd-item><a href=/reference/vm/lispmachine/>LispMachine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/tapemachine/ title=Tapemachine class=dd-item><a href=/reference/vm/tapemachine/>Tapemachine
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/misc/ title=Miscellaneous class=dd-item><a href=/misc/>Miscellaneous
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href="https://pkg.go.dev/gorgonia.org/gorgonia?tab=doc"><i class="fas fa-fw fa-bookmark"></i>API Doc</a></li><li><a class=padding href=http://gophers.slack.com/messages/gorgonia><i class="fab fa-fw fa-slack"></i>Contact us</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/tutorials/iris.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://schema.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>main</a> > <a href=/tutorials/>Tutorials</a> > Multivariate linear regression on Iris Dataset</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#about>About</a><ul><li><a href=#mathematical-representation>Mathematical representation</a></li><li><a href=#linear-regression>Linear regression</a></li></ul></li><li><a href=#generate-the-training-set-with-gota-dataframe>Generate the training set with gota (dataframe)</a><ul><li><a href=#create-the-expression-graph>Create the expression graph</a></li></ul></li><li><a href=#preparing-the-gradient-computation>Preparing the gradient computation</a><ul><li><a href=#create-the-node-holding-the-cost>Create the node holding the cost</a></li><li><a href=#the-gradient-descent>The gradient descent</a><ul><li><a href=#the-learning-iterations>The learning iterations</a></li><li><a href=#getting-some-infos>Getting some infos</a></li></ul></li><li><a href=#save-the-weights>Save the weights</a></li></ul></li><li><a href=#create-a-simple-cli-for-predictions>Create a simple CLI for predictions</a></li></ul></li><li><a href=#conclusion>Conclusion</a><ul><li><ul><li><a href=#bonus-visual-representation>Bonus: visual representation</a></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Multivariate linear regression on Iris Dataset</h1><h2 id=about>About</h2><p>We will use Gorgonia to create a linear regression model.</p><p>The goal is, to predict the species of the Iris flowers given the characteristics:</p><ul><li>sepal_length</li><li>sepal_width</li><li>petal_length</li><li>petal_width</li></ul><p>The species we want to predict are:</p><ul><li>setosa</li><li>virginica</li><li>versicolor</li></ul><p>The goal of this tutorial is to use Gorgonia to find the correct values of $\Theta$ given the iris dataset, in order to write a CLI utility that would look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>./iris
sepal length: 5
sepal width: 3.5
petal length: 1.4
sepal length: 0.2

It is probably a setosa</code></pre></div><div class="notices warning"><p>This tutorial is for academic purpose. Its goal is to describe how to do this with Gorgonia;
It is not the state of the art answer to this particular problem.</p></div><h3 id=mathematical-representation>Mathematical representation</h3><p>We will consider that the species of Iris if a function of its sepal length and width as well as its petal length and width.</p><p>Therefore, if we consider that $y$ is the value of the species, we the equation we would like to solve is:</p><p>$$ y = \theta_0 + \theta_1 * sepal\_length + \theta_2 * sepal\_width + \theta_3 * petal\_length + \theta_4 * petal\_width$$</p><p>Let&rsquo;s consider the vectors $x$ and $\Theta$ such as:</p><p>$$ x = \begin{bmatrix} sepal\_length &amp; sepal\_width &amp; petal\_length &amp; petal\_width &amp; 1\end{bmatrix}$$</p><p>$$
\Theta = \begin{bmatrix}
\theta_4<br>\theta_3<br>\theta_2<br>\theta_1<br>\theta_0<br>\end{bmatrix}
$$</p><p>We have</p><p>$$y = x\cdot\Theta$$</p><h3 id=linear-regression>Linear regression</h3><p>To find the correct values, we will use a linear regression.
We will encode the data (the true facts from observation of different flowers) into a matrix $X$ containing 5 columns (sepal length, sepal width, petal length, petal width and 1 for the bias).
A row of the matrix represent a flower.</p><p>The we will encode the corresponding species into a column vector $Y$ with float values.</p><ul><li>setosa = 1.0</li><li>virginica = 2.0</li><li>versicolor = 3.0</li></ul><p>In the learning phase, the cost is expressed like this:</p><p>$cost = \dfrac{1}{m} \sum_{i=1}^m(X^{(i)}\cdot\Theta-Y^{(i)})^2$</p><p>We will use the gradient descent to lower the cost and get the accurate values for $\Theta$</p><div class="notices info"><p>It is possible to get the exact $\theta$ values with the Normal Equation
$$ \theta = \left( X^TX \right)^{-1}X^TY $$
See this <a href=https://gist.github.com/owulveryck/19a5ba9553ff8209b3b4227b5325041b#file-normal-go>gist</a> for
a basic implementation with Gonum.</p></div><h2 id=generate-the-training-set-with-gota-dataframe>Generate the training set with gota (dataframe)</h2><p>First, let&rsquo;s generate the training data. We use a dataframe to do this smoothly.</p><div class="notices info"><p>See this <a href=/how-to/dataframe/>howto</a> for more info about using the dataframe</p></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>getXYMat</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>mat</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>mat</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Open</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;iris.csv&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>df</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>dataframe</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ReadCSV</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>xDF</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>df</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Drop</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;species&#34;</span><span style=color:#000;font-weight:700>)</span>

        <span style=color:#000>toValue</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span> <span style=color:#000>series</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Series</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>series</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Series</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>records</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>s</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Records</span><span style=color:#000;font-weight:700>()</span>
                <span style=color:#000>floats</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>records</span><span style=color:#000;font-weight:700>))</span>
                <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>r</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>records</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>r</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#34;setosa&#34;</span><span style=color:#000;font-weight:700>:</span>
                                <span style=color:#000>floats</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
                        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#34;virginica&#34;</span><span style=color:#000;font-weight:700>:</span>
                                <span style=color:#000>floats</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
                        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#34;versicolor&#34;</span><span style=color:#000;font-weight:700>:</span>
                                <span style=color:#000>floats</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
                        <span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span>
                                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unknown iris: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>r</span><span style=color:#000;font-weight:700>)</span>
                        <span style=color:#000;font-weight:700>}</span>
                <span style=color:#000;font-weight:700>}</span>
                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>series</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Floats</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>floats</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#000>yDF</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>df</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Select</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;species&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Capply</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>toValue</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>numRows</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>xDF</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dims</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>xDF</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>xDF</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mutate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>series</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>one</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>numRows</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>series</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bias&#34;</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xDF</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Describe</span><span style=color:#000;font-weight:700>())</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>yDF</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Describe</span><span style=color:#000;font-weight:700>())</span>

        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>mat</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DenseCopyOf</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>matrix</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>xDF</span><span style=color:#000;font-weight:700>}),</span> <span style=color:#000>mat</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DenseCopyOf</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>matrix</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>yDF</span><span style=color:#000;font-weight:700>})</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>This returns two matrices we can use in Gorgonia.</p><h3 id=create-the-expression-graph>Create the expression graph</h3><p>The equation $X\cdot\Theta$ is represented as an <a href=/reference/exprgraph>ExprGraph</a>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>getXY</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>getXYMat</span><span style=color:#000;font-weight:700>()</span>

	<span style=color:#000>xT</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FromMat64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>yT</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FromMat64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#8f5902;font-style:italic>// Get rid of the last dimension to create a vector
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>yT</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#000>yT</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>getXY</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodeFromAny</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodeFromAny</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
	<span style=color:#000>theta</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewVector</span><span style=color:#000;font-weight:700>(</span>
		<span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;theta&#34;</span><span style=color:#000;font-weight:700>),</span>
		<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xT</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]),</span>
		<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Uniform</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)))</span>

	<span style=color:#000>pred</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>theta</span><span style=color:#000;font-weight:700>))</span>
    <span style=color:#8f5902;font-style:italic>// Saving the value for later use
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>predicted</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span>
    <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pred</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>predicted</span><span style=color:#000;font-weight:700>)</span></code></pre></div><div class="notices info"><p>Gorgonia is higly optimized; it heavily plays with pointers and memory to get good performances.
Therefore, calling the <code>Value()</code> method of a <code>*Node</code> at runtime (during the execution process), may lead to incorrect results.
If we need to access a specific value of a *Node at runtime (for example during the learning phase), we need to keep a reference to its
underlying <code>Value</code>. This is why we use the <code>Read</code> method here.
<code>predicted</code> will hold a Value containing the result of $X\cdot\Theta$ at anytime.</p></div><h2 id=preparing-the-gradient-computation>Preparing the gradient computation</h2><p>We will use Gorgonia&rsquo;s <a href=/how-to/differentiation>Symbolic differentiation</a> capability.</p><p>First, we will create the cost function, and use a <a href=/about/solver>solver</a> to perform a gradient descent to lower the cost.</p><h3 id=create-the-node-holding-the-cost>Create the node holding the cost</h3><p>We complete the <a href=/reference/exprgraph>exprgraph</a> by adding the cost ($cost = \dfrac{1}{m} \sum_{i=1}^m(X^{(i)}\cdot\Theta-Y^{(i)})^2$)</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>squaredError</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Square</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sub</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pred</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>))))</span>
<span style=color:#000>cost</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mean</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>squaredError</span><span style=color:#000;font-weight:700>))</span></code></pre></div><p>We want to lower this cost, so we evaluate the gradient wrt to $\Theta$:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>theta</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Failed to backpropagate: %v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h3 id=the-gradient-descent>The gradient descent</h3><p>We are using the mechanism of the gradient descent. This means that we use the gradient to modulate the parameters $\Theta$
step by step.</p><p>The basic gradient descent is implemented by <a href=https://godoc.org/gorgonia.org/gorgonia#VanillaSolver>Vanilla Solver</a> of Gorgonia.
We set the learning rate $\gamma$ to be 0.001.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>solver</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewVanillaSolver</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithLearnRate</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.001</span><span style=color:#000;font-weight:700>))</span></code></pre></div><p>And at each step, we will ask the solver to update the $\Theta$ parameters thanks to its gradient.
Therefore, we set an <code>update</code> variable that we will pass to the solver at each iteration</p><div class="notices info"><p>The gradient descent will update the all the values passed into <code>[]gorgonia.ValueGrad</code> at each step according this equation:
${\displaystyle x^{(k+1)}=x^{(k)}-\gamma \nabla f\left(x^{(k)}\right)}$
It is important to understand that the solver works on <a href=/reference/value><code>Values</code></a> and not on <a href=/reference/node><code>Nodes</code></a>.
But to make things easy, ValueGrad is an interface{} fulfilled by the <code>*Node</code> structure.</p></div><p>In our case, we want to optimize $\Theta$ and ask the solver will update its value like this:</p><p>${\displaystyle \Theta^{(k+1)}=\Theta^{(k)}-\gamma \nabla f\left(\Theta^{(k)}\right)}$</p><p>To do so, we need to pass $\Theta$ to the <code>Step</code> method of the <code>Solver</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>model</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ValueGrad</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>theta</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#8f5902;font-style:italic>// ...
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h4 id=the-learning-iterations>The learning iterations</h4><p>Now that we have the principle, we need to run the computation with a <a href=/reference/vm>vm</a> several times so the gradient
descent&rsquo;s magic can happen.</p><p>Let&rsquo;s create a <a href=/reference/vm>vm</a> to execute the graph (and do the gradient computation):</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindDualValues</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>theta</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span></code></pre></div><div class="notices warning"><p>We will ask the solver to update the parameter $\Theta$ wrt to its gradient.
Therefore we must instruct the TapeMachine to store the value of $\Theta$ <em>as well as</em> its derivative (its dual value).
We do this with the <a href=https://godoc.org/gorgonia.org/gorgonia#BindDualValues>BindDualValues</a> function.</p></div><p>Now let&rsquo;s create the loop and execute the graph at each step; the machine will learn!</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>iter</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>1000000</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span>
<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>iter</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Error during iteration: %v: %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#204a87;font-weight:700>break</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reset</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// Reset is necessary in a loop like this
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span></code></pre></div><h4 id=getting-some-infos>Getting some infos</h4><p>We can dump some info about the learning process by using this call</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;theta: %2.2f  Iter: %v Cost: %2.3f Accuracy: %2.2f \r&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000>theta</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span>
        <span style=color:#000>i</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000>cost</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(),</span>
        <span style=color:#000>accuracy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>predicted</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>().([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>().([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)))</span></code></pre></div><p>with <code>accuracy</code> defined like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>accuracy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>prediction</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>float64</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>ok</span> <span style=color:#204a87;font-weight:700>float64</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>prediction</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>math</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>prediction</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1.0</span>
                <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#204a87>float64</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>This will display a line like this during the learning process:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>theta: [ 0.26  -0.41   0.44  -0.62   0.83]  Iter: 26075 Cost: 0.339 Accuracy: 0.61</code></pre></div><h3 id=save-the-weights>Save the weights</h3><p>Once the training is done, we save the values of $\Theta$ to be able to do some predictions:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>save</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>error</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Create</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;theta.bin&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#000>enc</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gob</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewEncoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>enc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Encode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h2 id=create-a-simple-cli-for-predictions>Create a simple CLI for predictions</h2><p>First, let&rsquo;s load the parameters from the training phase:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Open</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;theta.bin&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#000>dec</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gob</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDecoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>thetaT</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>dec</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Decode</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>thetaT</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span></code></pre></div><p>Then, let&rsquo;s create the model (the exprgraph) like we did before:</p><div class="notices info"><p>A real application would probably have shared the model in a separate package</p></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>theta</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodeFromAny</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>thetaT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;theta&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>values</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>xT</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithBacking</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>values</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodeFromAny</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>theta</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Then enter a for loop that will get info from stdin, do the computation and display the result:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>machine</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>values</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1.0</span>
<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>values</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>getInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;sepal length&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>values</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>getInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;sepal width&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>values</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>getInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;petal length&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>values</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>getInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;petal width&#34;</span><span style=color:#000;font-weight:700>)</span>

        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>math</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Round</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>Data</span><span style=color:#000;font-weight:700>().(</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;It is probably a setosa&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>:</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;It is probably a virginica&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>:</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;It is probably a versicolor&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unknown iris&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>machine</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reset</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>This is a helper function to get the input:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>getInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>float64</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>reader</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>bufio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewReader</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stdin</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v: &#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>text</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>reader</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ReadString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;\n&#39;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>text</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>strings</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Replace</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>

        <span style=color:#000>input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>strconv</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFloat</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>input</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>Now we can <code>go build</code> or <code>go run</code> the code, and <em>voil√†</em>!
We have a fully autonomous CLI that can predict the iris species regarding its features:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run main.go
sepal length: 4.4
sepal widt: 2.9
petal length: 1.4
petal width: 0.2
It is probably a setosa
sepal length: 5.9
sepal widt: 3.0
petal length: 5.1
petal width: 1.8
It is probably a virginica</code></pre></div><h1 id=conclusion>Conclusion</h1><p>This is a step by step example.
You can now play with the initialization values of theta, or change to solver to see how thing goes within Gorgonia.</p><p>The full code can be found in the <a href=https://github.com/gorgonia/gorgonia/tree/master/examples>example</a> of the Gorgonia project.</p><h3 id=bonus-visual-representation>Bonus: visual representation</h3><p>It is possible to visualize the dataset using the Gonum plotter libraries.
Here is a simple example on how to achieve it:</p><p><img src=/images/iris/iris.png alt=iris></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
    <span style=color:#4e9a06>&#34;gonum.org/v1/plot&#34;</span>
    <span style=color:#4e9a06>&#34;gonum.org/v1/plot/plotter&#34;</span>
    <span style=color:#4e9a06>&#34;gonum.org/v1/plot/plotutil&#34;</span>
    <span style=color:#4e9a06>&#34;gonum.org/v1/plot/vg&#34;</span>
    <span style=color:#4e9a06>&#34;gonum.org/v1/plot/vg/draw&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>plotData</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>p</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>plot</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Title</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Text</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;sepal length &amp; width&#34;</span>
	<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Text</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;length&#34;</span>
	<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Y</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Text</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;width&#34;</span>
	<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>plotter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGrid</span><span style=color:#000;font-weight:700>())</span>

	<span style=color:#000>l</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>k</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>k</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>k</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>data0</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>plotter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>XYs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>k</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>])</span> <span style=color:#000;font-weight:700>{</span>
				<span style=color:#204a87;font-weight:700>continue</span>
			<span style=color:#000;font-weight:700>}</span>
			<span style=color:#000>x1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>l</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic>// sepal_length
</span><span style=color:#8f5902;font-style:italic></span>			<span style=color:#000>y1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>l</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic>// sepal_width
</span><span style=color:#8f5902;font-style:italic></span>			<span style=color:#000>data0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>plotter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>XY</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>x1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>y1</span><span style=color:#000;font-weight:700>})</span>
		<span style=color:#000;font-weight:700>}</span>
		<span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>plotter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewScatter</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data0</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000;font-weight:700>}</span>
		<span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlyphStyle</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Color</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>plotutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Color</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>k</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>draw</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PyramidGlyph</span><span style=color:#000;font-weight:700>{}</span>
		<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Legend</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Sprint</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>k</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>p</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriterTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>vg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Inch</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>vg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Inch</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;png&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>b</span> <span style=color:#000>bytes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Buffer</span>
	<span style=color:#000>writer</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>bufio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewWriter</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>b</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>w</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriteTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>writer</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>ioutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriteFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;out.png&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>b</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Bytes</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#0000cf;font-weight:700>0644</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>b</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Bytes</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/tutorials/mnist-cuda/ title="Convnet with CUDA"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/how-to/ title="How To" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1677767295></script><script src=/js/perfect-scrollbar.min.js?1677767295></script><script src=/js/perfect-scrollbar.jquery.min.js?1677767295></script><script src=/js/jquery.sticky.js?1677767295></script><script src=/js/featherlight.min.js?1677767295></script><script src=/js/modernizr.custom-3.6.0.js?1677767295></script><script src=/js/learn.js?1677767295></script><script src=/js/hugo-learn.js?1677767295></script><link href=/mermaid/mermaid.css?1677767295 rel=stylesheet><script src=/mermaid/mermaid.js?1677767295></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>