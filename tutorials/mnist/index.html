<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia: Deep learning for Go - Write and evaluate mathematical equations involving multidimensional arrays (tensors) easily - this is the reference website with tutorials and howtos"><meta name=author content="The Gorgonia Authors"><link rel="shortcut icon" href=/images/favicon.png type=image/png><title>Simple Convolution Neural Net (MNIST) :: Gorgonia</title><link href=/css/nucleus.css?1677767295 rel=stylesheet><link href=/css/fontawesome-all.min.css?1677767295 rel=stylesheet><link href=/css/hybrid.css?1677767295 rel=stylesheet><link href=/css/featherlight.min.css?1677767295 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1677767295 rel=stylesheet><link href=/css/auto-complete.css?1677767295 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1677767295 rel=stylesheet><link href=/css/theme.css?1677767295 rel=stylesheet><link href=/css/hugo-theme.css?1677767295 rel=stylesheet><link href=/css/theme-gorgonia.css?1677767295 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1677767295></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="Simple Convolution Neural Net (MNIST)"><meta property=og:description content="About This a step by step tutorial to build and train a convolution neural network on the MNIST dataset.
The complete code can be found in the examples directory of the principal Gorgonia repository. The goal of this tutorial is to explain in detail the code. Further explanation of how it works can be found in the book Go Machine Learning Projects
The dataset This part is about loading and printing the dataset."><meta property=og:type content=article><meta property=og:url content=https://gorgonia.org/tutorials/mnist/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-29T20:09:05+01:00><meta property=article:modified_time content=2019-10-29T20:09:05+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="Simple Convolution Neural Net (MNIST)"><meta name=twitter:description content="About This a step by step tutorial to build and train a convolution neural network on the MNIST dataset.
The complete code can be found in the examples directory of the principal Gorgonia repository. The goal of this tutorial is to explain in detail the code. Further explanation of how it works can be found in the book Go Machine Learning Projects
The dataset This part is about loading and printing the dataset."></head><body data-url=/tutorials/mnist/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://gorgonia.org/><img src=https://gorgonia.org/images/logo/gorgonia.svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1677767295></script><script type=text/javascript src=/js/auto-complete.js?1677767295></script><script type=text/javascript>var baseurl="https:\/\/gorgonia.org\/";</script><script type=text/javascript src=/js/search.js?1677767295></script><ul><li><a class=padding><em class="fas fa-language fa-fw"></em><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://gorgonia.org/tutorials/mnist/ selected>English</option>
<option id=ja value=https://gorgonia.org/ja/tutorials/mnist/>Japanese</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/>Getting Started
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/getting-started/ubiquitous-language/ title="Ubiquitous Language and glossary" class=dd-item><a href=/getting-started/ubiquitous-language/>Ubiquitous Language and glossary
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/getting-started/contributing-doc/ title="Start contributing to the doc" class=dd-item><a href=/getting-started/contributing-doc/>Start contributing to the doc
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/about/ title="How Gorgonia works" class=dd-item><a href=/about/>How Gorgonia works
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/computation-graph/ title="Computation Graph" class=dd-item><a href=/about/computation-graph/>Computation Graph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/ title=Differentiation class=dd-item><a href=/about/differentiation/>Differentiation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/about/differentiation/autodiff/ title="Automatic Differentiation" class=dd-item><a href=/about/differentiation/autodiff/>Automatic Differentiation
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/about/differentiation/symbolicdiff/ title="Symbolic Differentiation" class=dd-item><a href=/about/differentiation/symbolicdiff/>Symbolic Differentiation
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/tutorials/ title=Tutorials class="dd-item
        parent"><a href=/tutorials/>Tutorials
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/tutorials/hello-world/ title="Hello World" class=dd-item><a href=/tutorials/hello-world/>Hello World
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist/ title="Simple Convolution Neural Net (MNIST)" class="dd-item active"><a href=/tutorials/mnist/>Simple Convolution Neural Net (MNIST)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/mnist-cuda/ title="Convnet with CUDA" class=dd-item><a href=/tutorials/mnist-cuda/>Convnet with CUDA
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/tutorials/iris/ title="Multivariate linear regression on Iris Dataset" class=dd-item><a href=/tutorials/iris/>Multivariate linear regression on Iris Dataset
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/how-to/ title="How To" class=dd-item><a href=/how-to/>How To
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/how-to/troubleshoot-gpu-issues/ title="Troubleshoot GPU Issues" class=dd-item><a href=/how-to/troubleshoot-gpu-issues/>Troubleshoot GPU Issues
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dot/ title="Drawing the ExprGraph with Graphviz (dot)" class=dd-item><a href=/how-to/dot/>Drawing the ExprGraph with Graphviz (dot)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/dataframe/ title="Create a tensor from a Dataframe (gota)" class=dd-item><a href=/how-to/dataframe/>Create a tensor from a Dataframe (gota)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/save-weights/ title="Save Weights" class=dd-item><a href=/how-to/save-weights/>Save Weights
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/how-to/autodiff/ title="How to compute gradient (differentiation)" class=dd-item><a href=/how-to/autodiff/>How to compute gradient (differentiation)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/reference/ title="Reference guide" class=dd-item><a href=/reference/>Reference guide
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/exprgraph/ title="Graph / Exprgraph" class=dd-item><a href=/reference/exprgraph/>Graph / Exprgraph
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/present/ title=Present class=dd-item><a href=/reference/present/>Present
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/cuda/ title="CUDA support" class=dd-item><a href=/reference/cuda/>CUDA support
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/tensor/ title=Tensor class=dd-item><a href=/reference/tensor/>Tensor
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/solver/ title=Solvers class=dd-item><a href=/reference/solver/>Solvers
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/ title=VM class=dd-item><a href=/reference/vm/>VM
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/reference/vm/gomachine/ title="Go Machine" class=dd-item><a href=/reference/vm/gomachine/>Go Machine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/lispmachine/ title=LispMachine class=dd-item><a href=/reference/vm/lispmachine/>LispMachine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/reference/vm/tapemachine/ title=Tapemachine class=dd-item><a href=/reference/vm/tapemachine/>Tapemachine
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/misc/ title=Miscellaneous class=dd-item><a href=/misc/>Miscellaneous
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub repo</a></li><li><a class=padding href="https://pkg.go.dev/gorgonia.org/gorgonia?tab=doc"><i class="fas fa-fw fa-bookmark"></i>API Doc</a></li><li><a class=padding href=http://gophers.slack.com/messages/gorgonia><i class="fab fa-fw fa-slack"></i>Contact us</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/tutorials/mnist.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://schema.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>main</a> > <a href=/tutorials/>Tutorials</a> > Simple Convolution Neural Net (MNIST)</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#about>About</a><ul><li><a href=#the-dataset>The dataset</a><ul><li><ul><li><a href=#the-mnist-package>The <code>mnist</code> package</a></li><li><a href=#testing-the-package>Testing the package</a></li></ul></li><li><a href=#image-representation>Image representation</a></li></ul></li></ul></li><li><a href=#the-convolution-neural-net>The convolution neural net</a><ul><li><a href=#variables-of-the-network>Variables of the network</a><ul><li><a href=#definition-of-the-learnables>Definition of the learnables</a></li></ul></li><li><a href=#definition-of-the-network>Definition of the network</a></li><li><a href=#training-the-neural-network>Training the neural network</a><ul><li><a href=#cost-function>Cost function</a><ul><li><a href=#the-training-loop>The training loop</a></li><li><a href=#inside-the-loop>Inside the loop:</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Simple Convolution Neural Net (MNIST)</h1><h2 id=about>About</h2><p>This a step by step tutorial to build and train a convolution neural network on the MNIST dataset.</p><p>The complete code can be found in the <code>examples</code> directory of the principal Gorgonia repository.
The goal of this tutorial is to explain in detail the code. Further explanation of how it works can be found in the
book <a href=https://www.packtpub.com/eu/big-data-and-business-intelligence/go-machine-learning-projects>Go Machine Learning Projects</a></p><h3 id=the-dataset>The dataset</h3><div class="notices info"><p>This part is about loading and printing the dataset. If you want to jump straight into the neural net, feel free to skip it and go to <a href=#the-convolution-neural-net>The Convolution Neural Net part</a>.</p></div><p>The training and testing sets can be downloaded from <a href=http://yann.lecun.com/exdb/mnist/>Yann LeCun&rsquo;s MNIST website</a></p><ul><li><a href=http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz>train-images-idx3-ubyte.gz</a>: training set images (9912422 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz>train-labels-idx1-ubyte.gz</a>: training set labels (28881 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz>t10k-images-idx3-ubyte.gz</a>: test set images (1648877 bytes)</li><li><a href=http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz>t10k-labels-idx1-ubyte.gz</a>: test set labels (4542 bytes)</li></ul><p>As explained on the website, those files hold multiple images or labels encoded in binary.
Every image/label starts with a magic number. The <code>encoding/binary</code> package of the standard library of Go makes it easy to read those files.</p><h5 id=the-mnist-package>The <code>mnist</code> package</h5><p>As a commodity, Gorgonia has created a package <code>mnist</code> in the <code>examples</code> subdirectory. Its goal is to extract the information from the data and to create <code>tensors</code>.</p><p>The function <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/io.go#L50:6><code>readImageFile</code></a> creates an array of bytes
that represents all the images contained in the reader.</p><p>A similar <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/io.go#L21><code>readLabelFile</code></a> function extracts the labels.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Image holds the pixel intensities of an image.
</span><span style=color:#8f5902;font-style:italic>// 255 is foreground (black), 0 is background (white).
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>RawImage</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span>

<span style=color:#8f5902;font-style:italic>// Label is a digit label in 0 to 9
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Label</span> <span style=color:#204a87;font-weight:700>uint8</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>readImageFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r</span> <span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reader</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>imgs</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>RawImage</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>readLabelFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r</span> <span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reader</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>labels</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Then two functions take care of the conversion from <code>RawImage</code> and <code>Label</code> into <code>tensor.Tensor</code>:</p><ul><li><a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L70>prepareX</a></li><li><p><a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L99>prepareY</a></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>prepareX</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>M</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>RawImage</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>retVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>prepareY</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>N</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#000>Label</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>retVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>)</span></code></pre></div></li></ul><p>The only exported function from the package is <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/mnist/mnist.go#L24><code>Load</code></a> that
reads the files <code>typ</code> from <code>loc</code> and returns tensors of a specific type (float32 or float64):</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Load loads the mnist data into two tensors
</span><span style=color:#8f5902;font-style:italic>//
</span><span style=color:#8f5902;font-style:italic>// typ can be &#34;train&#34;, &#34;test&#34;
</span><span style=color:#8f5902;font-style:italic>//
</span><span style=color:#8f5902;font-style:italic>// loc represents where the mnist files are held
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>loc</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>as</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dtype</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span></code></pre></div><h5 id=testing-the-package>Testing the package</h5><p>Now, let&rsquo;s create a simple main file to validate that the data are loaded.</p><p>This layout of the test directory is expected:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ ls -alhg *
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   375B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 main.go

testdata:
total <span style=color:#0000cf;font-weight:700>107344</span>
drwxr-xr-x  <span style=color:#0000cf;font-weight:700>6</span> staff   192B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 .
drwxr-xr-x  <span style=color:#0000cf;font-weight:700>4</span> staff   128B Nov <span style=color:#0000cf;font-weight:700>11</span> <span style=color:#0000cf;font-weight:700>13</span>:48 ..
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   <span style=color:#0000cf;font-weight:700>7</span>.5M Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> t10k-images.idx3-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff   <span style=color:#0000cf;font-weight:700>9</span>.8K Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> t10k-labels.idx1-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff    45M Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> train-images.idx3-ubyte
-rw-r--r--  <span style=color:#0000cf;font-weight:700>1</span> staff    59K Jul <span style=color:#0000cf;font-weight:700>21</span>  <span style=color:#0000cf;font-weight:700>2000</span> train-labels.idx1-ubyte</code></pre></div><p>Now let&rsquo;s write this simple Go file that will read both test and train data and display the resulting tensors:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#4e9a06>&#34;fmt&#34;</span>
        <span style=color:#4e9a06>&#34;log&#34;</span>

        <span style=color:#4e9a06>&#34;gorgonia.org/gorgonia/examples/mnist&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>typ</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;train&#34;</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>mnist</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;./testdata&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                        <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#000;font-weight:700>}</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34; inputs:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>())</span>
                <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>typ</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34; data:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>())</span>
        <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><p>Run the file:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ go run main.go
<span style=color:#204a87>test</span> inputs: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10000</span>, <span style=color:#0000cf;font-weight:700>784</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#204a87>test</span> data: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10000</span>, <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span>
train inputs: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>60000</span>, <span style=color:#0000cf;font-weight:700>784</span><span style=color:#ce5c00;font-weight:700>)</span>
train data: <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>60000</span>, <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span></code></pre></div><p>We have 60000 pictures of $28\times28=784$ pixels, 60000 corresponding labels &ldquo;one-hot&rdquo; encoded, and 10000 test files in the test set.</p><h4 id=image-representation>Image representation</h4><p>Let&rsquo;s draw a picture of the first element:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
        <span style=color:#8f5902;font-style:italic>//...
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#4e9a06>&#34;image&#34;</span>
        <span style=color:#4e9a06>&#34;image/png&#34;</span>

        <span style=color:#4e9a06>&#34;gorgonia.org/gorgonia/examples/mnist&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor&#34;</span>
        <span style=color:#4e9a06>&#34;gorgonia.org/tensor/native&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>mnist</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Load</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;train&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;./testdata&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Float64</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>cols</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
        <span style=color:#000>imageBackend</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>([]</span><span style=color:#204a87;font-weight:700>uint8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cols</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>cols</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>v</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>At</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
                <span style=color:#000>imageBackend</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>uint8</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>v</span><span style=color:#000;font-weight:700>.(</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>0.1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>0.9</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>img</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>image</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Gray</span><span style=color:#000;font-weight:700>{</span>
                <span style=color:#000>Pix</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#000>imageBackend</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>Stride</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#000>Rect</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#000>image</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rect</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>),</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Create</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;output.png&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#000>vals</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>native</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MatrixF64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>targets</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>])</span>
        <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>png</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Encode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>img</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class="notices info"><p>We are using the <code>native</code> package to access the underlying <code>[]float64</code> backend easily. This operation does not generate new data.</p></div><p>This produce this png file:
<img src="/images/mnist_5.png?width=10pc" alt=5></p><p>and the corresponding label vector that indicates that it is a <code>5</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ go run main.go
<span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.9 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1 <span style=color:#0000cf;font-weight:700>0</span>.1<span style=color:#ce5c00;font-weight:700>]</span></code></pre></div><h2 id=the-convolution-neural-net>The convolution neural net</h2><p>We are building a 5 layers convolution network. $x_0$ is the input image, as defined previously.</p><p>The first three layers $i$ are defined this way:</p><p>$ x_{i+1} = Dropout(Maxpool(ReLU(Convolution(x_i,W_i)))) $</p><p>with $i$ in range 0-2</p><p>The fourth layer is basically a dropout layer to randomly zeroed some activations:</p><p>$ x_{4} = Dropout(ReLU(x_3\cdot W_3)) $</p><p>The final layer applies a simple multiplication and a softmax in order to get an output vector (this vector represent the label predicted):</p><p>$ y = softmax(x_4\cdot W_4)$</p><h3 id=variables-of-the-network>Variables of the network</h3><p>The learnables parameters are $W_0,W_1,W_2,W_3,W_4$. Other variables of the network are the dropout probabilities $d_0,d_1,d_2,d_3$.</p><p>Let&rsquo;s create a structure to hold the variables and the output node of the model:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>convnet</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>g</span>                  <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExprGraph</span>
	<span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w4</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span> <span style=color:#8f5902;font-style:italic>// weights. the number at the back indicates which layer it&#39;s used for
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>d0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>d3</span>     <span style=color:#204a87;font-weight:700>float64</span>        <span style=color:#8f5902;font-style:italic>// dropout probabilities
</span><span style=color:#8f5902;font-style:italic></span>
	<span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h4 id=definition-of-the-learnables>Definition of the learnables</h4><p>The convolution is using a standard $3\times3$ kernel, and 32 filters.
As the images of the dataset are in black and white, we are using only one channel. This lead to the following definition of the weights:</p><ul><li>$W_0 \in \mathbb{R}^{32\times 1\times3\times3}$ for the first convolution operator</li><li>$W_1 \in \mathbb{R}^{64\times 32\times3\times3}$ for the second convolution operator</li><li>$W_2 \in \mathbb{R}^{128\times 64\times3\times3}$ for the third convolution operator</li><li>$W_3 \in \mathbb{R}^{128*3*3\times 625}$ we are preparing the final matrix multiplication, so we need to reshape the 4D input into a matrix (128x3x3). 625 is an arbitrary number.</li><li>$W_4 \in \mathbb{R}^{625\times 10}$ to reduce the output size to a single vector of 10 entries</li></ul><div class="notices note"><p>In NN optimization, it&rsquo;s commonly known that if you have a middle layer that is smaller than the output and input,
you are &ldquo;squeezing&rdquo; useless information.
Input is 784; then next layer should be smaller. 625 is a good looking number.</p></div><p>The dropout probabilities are fixed to idiomatic values:</p><ul><li>$d_0=0.2$</li><li>$d_1=0.2$</li><li>$d_2=0.2$</li><li>$d_3=0.55$</li></ul><p>We can now create the structure with the placeholder for the learnables:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// Note: gorgonia is abbreviated G in this example for clarity
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>newConvNet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExprGraph</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>w0</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w0&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w1&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w2</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w2&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w3</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>128</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>625</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w3&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#000>w4</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>625</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;w4&#34;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithInit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>G</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GlorotN</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>)))</span>
	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>g</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>w4</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>w4</span><span style=color:#000;font-weight:700>,</span>

		<span style=color:#000>d0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.2</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>d3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0.55</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><div class="notices info"><p>The learnables are initialized with some values normally sampled using Glorot et al.&rsquo;s algorithm. For more info: <a href=https://arxiv.org/pdf/1511.06422.pdf>All you need is a good init</a> on Arxiv.</p></div><h3 id=definition-of-the-network>Definition of the network</h3><p>It is now possible to define the network by adding a method to the convnet structure:</p><p><em>Note</em>: error checking are, once again, removed for clarity</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8f5902;font-style:italic>// This function is particularly verbose for educational reasons. In reality, you&#39;d wrap up the layers within a layer struct type and perform per-layer activations
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>fwd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>fc</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>a3</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>p2</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>l3</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>

	<span style=color:#8f5902;font-style:italic>// LAYER 0
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// here we convolve with stride = (1, 1) and padding = (1, 1),
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// which is your bog standard convolution for convnet
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c0</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d0</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 1
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c1</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d1</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 2
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Conv2d</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c2</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>p2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MaxPool2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>})</span>

	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>r2</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#000>b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>w</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>p2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>
	<span style=color:#000>r2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>p2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>w</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d2</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// Layer 3
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>fc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w3</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>a3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Rectify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fc</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>l3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dropout</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>d3</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#8f5902;font-style:italic>// output decode
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Node</span>
	<span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w4</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SoftMax</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>return</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h3 id=training-the-neural-network>Training the neural network</h3><p>The input we got from the training set are a matrix $numExample \times 784$. The convolution operator expects a 4D tensor BCHW. The first thing we need to do is to reshape the input:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>numExamples</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Shape</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>numExamples</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>We will train the network by batch. The batch size is a variable (<code>bs</code>). We create two new tensors that will hold the values and labels of the current batch.
Then we instantiate the neural net:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewGraph</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTensor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>y</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewMatrix</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithShape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;y&#34;</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>newConvNet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fwd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span></code></pre></div><h4 id=cost-function>Cost function</h4><p>We define a cost function we want to minimize based on a simple cross-entropy by multiplying the expected output element-wise and then averaging it:</p><p>$cost = -\dfrac{1}{bs} \sum_{i=1}^{bs}(pred^{(i)}\cdot y^{(i)})$</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>losses</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HadamardProd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>cost</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Mean</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>losses</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>cost</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Must</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Neg</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>))</span></code></pre></div><p>and keep a pointer on the value of the cost for later:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>costVal</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Value</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Read</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>costVal</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Then we will perform symbolic backpropagation with:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Grad</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cost</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Learnables is defined like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>convnet</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nodes</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nodes</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>w4</span><span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h5 id=the-training-loop>The training loop</h5><p>First we need a <a href=/reference/vm>vm</a> to run the graph, and a solver to adapt the learnables at each step. We also need to bind the dual values of the learnables to
actually store the values of the gradient for the solver to work.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>vm</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTapeMachine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>g</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindDualValues</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>))</span>
<span style=color:#000>solver</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewRMSPropSolver</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WithBatchSize</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>float64</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>)))</span>
<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span></code></pre></div><p>We define a number of batches that compose an epoch regarding the batchsize:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>batches</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>numExamples</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>bs</span></code></pre></div><p>and then create the training loops:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>epochs</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>b</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>batches</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#8f5902;font-style:italic>// ...
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></div><h5 id=inside-the-loop>Inside the loop:</h5><p>Now we need to extract values from the input tensor (which is $60000 \times 784$) for each batch.
Each input is ($bs\times 784$). First batch will hold values from 0 to bs-1, second bs to 2*bs-1, and so on. Then the tensor is reshaped into a 4D tensor:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>xVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yVal</span> <span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Tensor</span>
<span style=color:#000>xVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Slice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sli</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>end</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#000>yVal</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>targets</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Slice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sli</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>end</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#000>xVal</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>tensor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Dense</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>Reshape</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>28</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>Then we assign the values to the graph:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>xVal</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Let</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>yVal</span><span style=color:#000;font-weight:700>)</span></code></pre></div><p>and run the VM and the solver to adapt the weights</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RunAll</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gorgonia</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NodesToValueGrads</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>learnables</span><span style=color:#000;font-weight:700>()))</span>
<span style=color:#000>vm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Reset</span><span style=color:#000;font-weight:700>()</span></code></pre></div><p>That&rsquo;s it, you now have a neural network that can learn.</p><h3 id=conclusion>Conclusion</h3><p>Running the code is relatively slow due to the massive amount of data involved, but it learns.
You can get the full code in the <a href=https://github.com/gorgonia/gorgonia/blob/e6bc7dd8951410b733bb85091d0e4506c25e6f70/examples/convnet/main.go#L1>Gorgonia&rsquo;s example directory</a>.</p><p>To save the weights, the user can create two methods of <code>load</code> and <code>save</code> as described in the <a href=/tutorials/iris>iris tutorial</a>.
Then it is let as an exercise to the reader to code a little utility to use this neural network.</p><p>Have fun!</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/tutorials/hello-world/ title="Hello World"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/tutorials/mnist-cuda/ title="Convnet with CUDA" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1677767295></script><script src=/js/perfect-scrollbar.min.js?1677767295></script><script src=/js/perfect-scrollbar.jquery.min.js?1677767295></script><script src=/js/jquery.sticky.js?1677767295></script><script src=/js/featherlight.min.js?1677767295></script><script src=/js/modernizr.custom-3.6.0.js?1677767295></script><script src=/js/learn.js?1677767295></script><script src=/js/hugo-learn.js?1677767295></script><link href=/mermaid/mermaid.css?1677767295 rel=stylesheet><script src=/mermaid/mermaid.js?1677767295></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>